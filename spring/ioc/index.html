<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>控制反转 | 桉树</title><meta name="description" content="考拉的粮食">
    <link rel="modulepreload" href="/assets/app.00e82ae7.js"><link rel="modulepreload" href="/assets/index.html.959c8cce.js"><link rel="modulepreload" href="/assets/index.html.c2e34699.js"><link rel="prefetch" href="/assets/index.html.d8d8e853.js"><link rel="prefetch" href="/assets/index.html.dfaf787b.js"><link rel="prefetch" href="/assets/index.html.7f09570d.js"><link rel="prefetch" href="/assets/singleton.html.1f99f4b0.js"><link rel="prefetch" href="/assets/byte.html.9e0965c8.js"><link rel="prefetch" href="/assets/calculate.html.6adca823.js"><link rel="prefetch" href="/assets/collection.html.8791ed9c.js"><link rel="prefetch" href="/assets/enum.html.2bf74a6e.js"><link rel="prefetch" href="/assets/map.html.b875c291.js"><link rel="prefetch" href="/assets/string.html.f7ba752a.js"><link rel="prefetch" href="/assets/index.html.858487a1.js"><link rel="prefetch" href="/assets/index.html.c47a9954.js"><link rel="prefetch" href="/assets/index.html.a3d742ea.js"><link rel="prefetch" href="/assets/index.html.237e47d5.js"><link rel="prefetch" href="/assets/index.html.0e354957.js"><link rel="prefetch" href="/assets/index.html.3c145cd8.js"><link rel="prefetch" href="/assets/index.html.7d1cda21.js"><link rel="prefetch" href="/assets/README_OLD.html.b03dae1c.js"><link rel="prefetch" href="/assets/ant.html.3ba43451.js"><link rel="prefetch" href="/assets/controller.html.4b351758.js"><link rel="prefetch" href="/assets/index.html.9663bcb5.js"><link rel="prefetch" href="/assets/404.html.265028f6.js"><link rel="prefetch" href="/assets/index.html.356c8cc0.js"><link rel="prefetch" href="/assets/index.html.d148dd47.js"><link rel="prefetch" href="/assets/index.html.b082734f.js"><link rel="prefetch" href="/assets/singleton.html.318c26ed.js"><link rel="prefetch" href="/assets/byte.html.2bcd1ea3.js"><link rel="prefetch" href="/assets/calculate.html.8bdaadda.js"><link rel="prefetch" href="/assets/collection.html.3511e08e.js"><link rel="prefetch" href="/assets/enum.html.96984402.js"><link rel="prefetch" href="/assets/map.html.395980ea.js"><link rel="prefetch" href="/assets/string.html.8a840237.js"><link rel="prefetch" href="/assets/index.html.5a75afe3.js"><link rel="prefetch" href="/assets/index.html.f13d7e17.js"><link rel="prefetch" href="/assets/index.html.a724f9ff.js"><link rel="prefetch" href="/assets/index.html.00ed60ac.js"><link rel="prefetch" href="/assets/index.html.075e22e7.js"><link rel="prefetch" href="/assets/index.html.b384268d.js"><link rel="prefetch" href="/assets/index.html.74355523.js"><link rel="prefetch" href="/assets/README_OLD.html.0eb1b87f.js"><link rel="prefetch" href="/assets/ant.html.2b5fbdc3.js"><link rel="prefetch" href="/assets/controller.html.5c009f8b.js"><link rel="prefetch" href="/assets/index.html.4a05b6b7.js"><link rel="prefetch" href="/assets/404.html.bf2fe065.js"><link rel="prefetch" href="/assets/404.5ca82847.js"><link rel="prefetch" href="/assets/Layout.8e240054.js">
    <link rel="stylesheet" href="/assets/style.96ee71b5.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="https://vuejs.org/images/logo.png" alt="桉树"><span class="site-name can-hide">桉树</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/java/basic/" class="" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a aria-current="page" href="/spring/ioc/" class="router-link-active router-link-exact-active router-link-active" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="系统设计"><span class="title">系统设计</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="系统设计"><span class="title">系统设计</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>认证授权</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/security/spring-security/" class="" aria-label="Spring Security 5"><!--[--><!--]--> Spring Security 5 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>消息队列</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/message-queue/basic/" class="" aria-label="基础知识"><!--[--><!--]--> 基础知识 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/message-queue/kafka/" class="" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/message-queue/rocket-mq/" class="" aria-label="RocketMQ"><!--[--><!--]--> RocketMQ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/message-queue/rabbit-mq/" class="" aria-label="RabbitMQ"><!--[--><!--]--> RabbitMQ <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a href="/author/" class="" aria-label="关于作者"><!--[--><!--]--> 关于作者 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/java/basic/" class="" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a aria-current="page" href="/spring/ioc/" class="router-link-active router-link-exact-active router-link-active" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="系统设计"><span class="title">系统设计</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="系统设计"><span class="title">系统设计</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>认证授权</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/security/spring-security/" class="" aria-label="Spring Security 5"><!--[--><!--]--> Spring Security 5 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>消息队列</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/message-queue/basic/" class="" aria-label="基础知识"><!--[--><!--]--> 基础知识 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/message-queue/kafka/" class="" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/message-queue/rocket-mq/" class="" aria-label="RocketMQ"><!--[--><!--]--> RocketMQ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/message-queue/rabbit-mq/" class="" aria-label="RabbitMQ"><!--[--><!--]--> RabbitMQ <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a href="/author/" class="" aria-label="关于作者"><!--[--><!--]--> 关于作者 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">基础知识 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/spring/ioc/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="控制反转"><!--[--><!--]--> 控制反转 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/spring/ioc/#原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="原理"><!--[--><!--]--> 原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/spring/ioc/#spring中的ioc" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring中的IOC"><!--[--><!--]--> Spring中的IOC <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/spring/ioc/#beandefinition" class="router-link-active router-link-exact-active sidebar-item" aria-label="BeanDefinition"><!--[--><!--]--> BeanDefinition <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/spring/ioc/#bean" class="router-link-active router-link-exact-active sidebar-item" aria-label="Bean"><!--[--><!--]--> Bean <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/spring/ioc/#bean的生命周期" class="router-link-active router-link-exact-active sidebar-item" aria-label="Bean的生命周期"><!--[--><!--]--> Bean的生命周期 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/spring/ioc/#装配" class="router-link-active router-link-exact-active sidebar-item" aria-label="装配"><!--[--><!--]--> 装配 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/spring/ioc/#番外" class="router-link-active router-link-exact-active sidebar-item" aria-label="番外"><!--[--><!--]--> 番外 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/spring/ioc/#优雅设计" class="router-link-active router-link-exact-active sidebar-item" aria-label="优雅设计"><!--[--><!--]--> 优雅设计 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/spring/event/" class="sidebar-item" aria-label="事件"><!--[--><!--]--> 事件 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">实用技巧 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/spring/skills/ant.html" class="sidebar-item" aria-label="Ant路径风格"><!--[--><!--]--> Ant路径风格 <!--[--><!--]--></a><!----></li><li><a href="/spring/skills/controller.html" class="sidebar-item" aria-label="视图层"><!--[--><!--]--> 视图层 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="控制反转" tabindex="-1"><a class="header-anchor" href="#控制反转" aria-hidden="true">#</a> 控制反转</h1><p>控制反转(<strong>I</strong>nversion <strong>O</strong>f <strong>C</strong>ontrol), 是Spring的核心之一</p><p>它是一种思想, 或者说是设计理念, 并不局限于框架和开发语言</p><p>对于控制反转的理解, 我们不应流于形式或字面意思, 而是从系统设计人员的角度进行思考与探索, 如此这般才能切身体会它的精妙与创造力</p><h2 id="原理" tabindex="-1"><a class="header-anchor" href="#原理" aria-hidden="true">#</a> 原理</h2><p>控制反转, 按照中文字面解读, 我们往往会习惯于将重点放在<strong>控制</strong>这个词上, 实际上它的主要内容是<strong>反转</strong></p><p>有人可能会说, 没错, 反转的就是控制权嘛</p><p>很可惜, 事实并非如此, 反转的是<strong>获取依赖方式</strong></p><p>开头提到了, 控制反转是一种思想, 我们可以将其理解为Java的接口, 它有两种具体的实现: 依赖查找(<strong>D</strong>ependency <strong>L</strong>ookup)和依赖注入(<strong>D</strong>ependency <strong>I</strong>njection)</p><p>看到了吗?它们的开头都是<strong>依赖</strong></p><p>我们以依赖查找为例:</p><p>假设现在系统中存在一个IOC容器, 我们用Map模拟即可: <code>Map&lt;String, Object&gt; context</code>, 它的key是依赖名称, value是依赖实际内容</p><p>创建一个类<code>A</code>:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>再创建一个需要<code>A</code>依赖的<code>B</code>:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">A</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建<code>A</code>的实例, 并把它注册到IOC容器中:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IocApplication</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来创建<code>B</code>的实例时, 我们可以直接从IOC容器中找到刚才创建好的<code>A</code>实例:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IocApplication</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从IOC容器中查找依赖<code>A</code>的过程, 也就是<code>context.get(&quot;a&quot;)</code>, 便是依赖查找</p><p>当然, 实际的依赖查找会更加复杂, 例如Spring的依赖查找通常使用<code>BeanFactory</code>的<code>getBean</code>方法</p><p>再来反观传统方式的实例创建:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaApplication</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">A</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">B</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对比一下这两种方式:</p><ul><li>传统方式: <code>B</code>要求代码提供一个<code>A</code>的实例, 依赖获取方式是<strong>主动</strong>的</li><li>依赖查找: IOC容器查找一个<code>A</code>的依赖, 把它赋予<code>B</code>, 依赖的保存/获取甚至创建都是由IOC容器完成的, 方式是<strong>被动</strong>的</li></ul><p>如果还是不好理解, 我们把<code>B</code>改造一下, 变成依赖注入:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
  <span class="token comment">// Spring中是@Autowired</span>
  <span class="token annotation punctuation">@Resource</span>
  <span class="token keyword">private</span> <span class="token class-name">A</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>是不是非常明朗了?</p><p>所以, 谈及Spring就挂在嘴边的控制反转, 实际是<strong>依赖获取方式的反转</strong></p><p>这里延申一下, 在Spring中我们常使用的控制反转是依赖注入</p><p>相较于依赖查找, <strong>依赖注入不需要熟知框架的接口(就是刚才提过的<code>BeanFactory</code>的<code>getBean</code>), 耦合度更低</strong></p><h2 id="spring中的ioc" tabindex="-1"><a class="header-anchor" href="#spring中的ioc" aria-hidden="true">#</a> Spring中的IOC</h2><p>在Spring中, 控制反转主要由以下内容完成:</p><ul><li><code>BeanDefinition</code>: Bean的定义</li><li><code>Bean</code>: Bean实例</li><li><code>BeanFactory</code>: Bean工厂, 即IOC容器</li></ul><p>相较于<code>BeanFactory</code>, 更广为人知的是<code>ApplicationContext</code></p><p>它其实是<code>BeanFactory</code>的拓展, 内部通常组合了<code>BeanFactory</code>, 除控制反转外, 还包括Bean生命周期/后置处理器/事件等</p><p>如果对事件感兴趣, 可以参考<a href="https://houtaroy.github.io/spring/event/" target="_blank" rel="noopener noreferrer">这篇文章<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>下面笔者将对Spring中IOC的相关内容进行简单阐述</p><p>其实每个小节都可以展开详细讨论, 如果读者有兴趣, 会在后续更新对应的文章</p><h3 id="beandefinition" tabindex="-1"><a class="header-anchor" href="#beandefinition" aria-hidden="true">#</a> BeanDefinition</h3><p><code>BeanDefinition</code>, 顾名思义, 它就是<code>Bean</code>的定义</p><p>在Spring的IOC中, Bean可能为各式各样的Class, 它们的类名/构造函数/属性等等均不相同, 所以需要一个统一的描述或定义来确认每个Bean的信息, 这个东西就叫做<code>BeanDefinition</code>, 我们也可以把它称为Bean的元信息</p><p>它包含的大致信息如下:</p><ul><li>全限定类名</li><li>作用域</li><li>是否延迟加载</li><li>工厂Bean名称</li><li>构造方法参数列表</li><li>属性值</li></ul><p>感兴趣的读者可以自己使用IDE查看<code>BeanDefinition</code>的构成</p><h3 id="bean" tabindex="-1"><a class="header-anchor" href="#bean" aria-hidden="true">#</a> Bean</h3><p>这里不再对<code>Bean</code>有过多赘述, 只简单列举下它的类型和作用域</p><p><code>Bean</code>的类型:</p><ul><li>普通<code>Bean</code>: 它是Spring控制反转中最基础的内容, 不过它的基础是上一节的<code>BeanDefinition</code></li><li>工厂<code>Bean</code>: 也就是<code>FactoryBean</code>, 它是用来创建普通<code>Bean</code>的工厂, 真正涉及业务逻辑的是由它创建的普通<code>Bean</code></li></ul><p><code>Bean</code>的作用域:</p><ul><li>Singleton: 单例, 一个 IOC 容器中只有一个</li><li>Prototype: 原型, 每次获取创建一个</li></ul><p><strong>注意: 单例作用域的Bean是线程不安全的, 应是无状态的</strong></p><p>对于Bean的依赖注入, Spring官方推荐使用<strong>构造器注入</strong>, 它拥有下列优点:</p><ul><li>不可变</li><li>完全初始化的</li><li>保证不为null</li></ul><p>如果因此导致构造器参数列表过长, 其主要原因是Bean承担的职责过多, 应首先考虑对其进行拆解</p><h3 id="bean的生命周期" tabindex="-1"><a class="header-anchor" href="#bean的生命周期" aria-hidden="true">#</a> Bean的生命周期</h3><p>Bean的生命周期分为两个阶段: <code>BeanDefinition</code>和Bean实例</p><p><code>BeanDefinition</code>:</p><ol><li>解析配置(xml或注解)</li><li>编程式构造<code>BeanDefinition</code></li><li>后置处理</li></ol><p>Bean实例:</p><ol><li>实例化</li><li>属性赋值 + 依赖注入</li><li>初始化生命周期回调</li><li>实例的销毁</li></ol><p>列举几个常用的后置处理器:</p><ul><li><code>BeanDefinitionRegistryPostProcessor</code>: 所有<code>BeanDefinition</code>注册完成, 即将加载到<code>BeanFactory</code>时的后置处理器, 可用于新增<code>BeanDefinition</code></li><li><code>BeanFactoryPostProcessor</code>: 所有<code>BeanDefinition</code>在<code>BeanFactory</code>中加载结束的后置处理器, 可用于修改<code>BeanDefinition</code></li><li><code>BeanPostProcessor</code>: <code>Bean</code>初始化阶段前后进行干预</li></ul><h3 id="装配" tabindex="-1"><a class="header-anchor" href="#装配" aria-hidden="true">#</a> 装配</h3><p>共有三种装配方式: 模块装配/条件装配/组件扫描</p><p>模块装配通常使用自定义的<code>@EnableXXX</code>注解 + <code>@Import</code>完成, 如果需要自动装配, 可使用Spring的SPI</p><p>条件装配分为profile和conditional, 前者基于程序整体层面的多环境配置, 后者基于bean层面, 更加灵活</p><p>组件扫描使用<code>@ComponentScan</code>注解, 可以指定<code>includeFilters</code>和<code>excludeFilters</code>来进行过滤</p><h2 id="番外" tabindex="-1"><a class="header-anchor" href="#番外" aria-hidden="true">#</a> 番外</h2><h3 id="优雅设计" tabindex="-1"><a class="header-anchor" href="#优雅设计" aria-hidden="true">#</a> 优雅设计</h3><p>在Spring的IOC容器设计中, 普遍使用的设计思路是: 父类控制流程 + 子类实现细节, 用到的设计模式为: 模板方法</p><p>并且在类的命名上十分清晰, 我们以<code>DefaultListableBeanFactory</code>为例, 它的类图如下:</p><p><img src="/assets/DefaultListableBeanFactory.e6bcc771.png" alt="DefaultListableBeanFactory"></p><p><code>BeanFactory</code>有两个子接口<code>ListableBeanFactory</code>和<code>ConfigurableBeanFactory</code>, 而<code>ConfigurableListableBeanFactory</code>则继承了二者</p><p><code>DefaultListableBeanFactory</code>实现了<code>ConfigurableListableBeanFactory</code></p><p>仔细看看图中五个接口或类的名字, 它们的责任能力, 甚至继承关系都十分明朗, 千万不要小看了命名, 这世间所有优雅都出自名称</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">更新时间: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: Houtaroy@gmail.com">Houtaroy</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: houtaroy@gmail.com">houtaroy</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/spring/event/" class="" aria-label="事件"><!--[--><!--]--> 事件 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.00e82ae7.js" defer></script>
  </body>
</html>
